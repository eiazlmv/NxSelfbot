# -*- coding: utf-8 -*-

import LINEVIT
from LINEVIT.lib.curve.ttypes import *
from datetime import datetime
import time,random,sys,json,codecs,threading,glob,requests,urllib,urllib2,urllib3
from bs4 import BeautifulSoup
from urllib import urlopen
from gtts import gTTS
from googletrans import Translator

cl = LINEVIT.LINE()
cl.login(token="
cl.loginResult()
ki=ki2=ki3=ki4=cl


print u"login success"
reload(sys)
sys.setdefaultencoding('utf-8')

helpMessage ="""
[SELFBOT TAG By VIT]
[喔喔赤釜喔编喔喔喔喔喙喔喙喔]

[Tag@@]
[喔ム喔喔赤釜喔编喔喔喔掂副喙喔喔粪喔喙喔喔喔喔喔喙喙喔喔喔ム父喙喔]

[喔喔赤釜喔编喔喙17喔喔粪腑喔喙喔喔喔侧17喔喔ム]
[喔⑧腹喔喔灌]

[喔喔编抚喔喔⑧喔侧]
喔⑧腹喔喔灌17 喙17喔喔ム喔喔脆喔喔多17

[喔喔赤釜喔编喔喙17喔喙喔喔喔喔喙喔侧]17
[喔喙喙喔喙17喔о弗喔]
[喔喙喔侧]

[喔喔灌喔喔｀喔侧喔喔喔]
[By.78212521さ3029111662212428242978]
http://line.me/ti/p/9r-uE5EU09
"""

Thaihelp ="""
"""

helo=""

KAC=[cl]
mid = cl.getProfile().mid
Bots = [mid,""]
bot1 = cl.getProfile().mid
admsa = ""
admin = ""

wait = {
    'contact':False,
    'autoJoin':False,
    'autoCancel':{"on":True,"members":50},
    'leaveRoom':False,
    'timeline':False,
    'message':"""[By.78212521さ3029111662212428242978].
     http://line.me/ti/p/9r-uE5EU09
    
 喔ム喔喔｀赴喔喔喙喔17 喔ム喔喔｀赴喔喔喙喔17
      喔｀覆喔喔侧17喔喔ム弗喙喔喔喔喔о副喔喔喔掂17
喙17喔喔脆喔喙喔侧喔喔灌喙喔侧喔ム喔侧喙喔ム涪



[By.喔∴复喔喔喔掂浮喔喔喔ム腑喔喔喔喔]

===喔喔侧涪喔喔喔喔喔｀覆喔===

Self  Kicker Premium

Bot Protect
多腑喔喔喙喔喔喔喔ム父喙喔∴腑喔编喙喔喔∴副喔17
多斧喔｀阜喔喔｀副喔喙喔∴喙17喔喙喔17
喔∴傅喔喔赤釜喔编喔喙17喔о弗喔侧釜喔∴覆喔喔脆喙喔喔班喔喔喔粪喔
喔喔编抚喙喔｀覆喔喔班17喔喔班喔喔喔编喔喔喔喔喔喔侧喔喔ム父喙喔∴喔编喔喔
喔喔侧浮喔侧福喔喙17喔喔脆喔∴喔脆喙喔喔喔｀喔喔班17喔喔｀复喔∴喔侧福喔喙喔喔喔喔编喔喔ム父喙喔17
喙喔喙喔∴傅喔喔о覆喔∴浮喔编喔喔喔喙喔喙

班釜喙喔о喔喔喔喔喔脆喔喔ム父喙喔∴喔灌喙喔侧喔ム喔侧喔喔班喔｀副喔17
仇仇仇仇仇仇仇

喙17喔喔ム喔喔喔喔｀傅喙17喔∴傅喔⑧浮 喔喔灌喔ム喔ム腑喔喔喔侧福喙喔喙
喔喔赤釜喔编喔喔喔侧俯喔侧喔喔⑧喔喙喔喙喔侧涪
喔｀覆喔喔 喙17喔喔喔侧赴喙17喔喔 200喔喔侧喙喔喔
掂17喔喔脆喔 Kicker 
1 kicker= 100喔喔侧喙喔喔 喔｀抚喔∴喙喔侧喔喔17
2 kicker= 200喔喔侧喙喔喔 喔｀抚喔∴喙喔侧喔喔17
3 kicker= 300喔喔侧喙喔喔 喔｀抚喔∴喙喔侧喔喔17
5 kicker= 500喔喔侧喙喔喔 喔｀抚喔∴喙喔侧喔喔17
10 kicker= 800喔喔侧喙喔喔 喔｀抚喔∴喙喔侧喔喔17
喙17喔喔ム喔喔喔喔掂浮(1喙17喔喔/10喔喔脆17)= 1000喔17
#===================
喙17喔喔ム弗喙喔喔喔喔喔脆 喔喔｀阜喔喔ム喔喔∴覆喔喔脆
     喔喔о覆喔∴釜喔侧浮喔侧福喔
喔ム喔喔∴覆喔喔脆喔喙喙喔喔喙喔喔500喔喔喔ム喔喔侧涪喙喔1710喔о复
喔ム喔喔喔喔喔脆福喔脆喔喙喔喙喔侧涪喙17
喙17喔喔ム弗喙喔喔喔喔喔脆喙喔  
喔｀覆喔喔侧喙喔喔喔侧福喔ム  = 
喔ム2喔喔｀副喙喔17 = 喔｀覆喔喔 200 喔喔侧喙喔喔
喔ム4喔喔｀副喙喔17 = 喔｀覆喔喔 400 喔喔侧喙喔喔
喔ム8喔喔｀副喙喔17 = 喔｀覆喔喔 800 喔喔侧喙喔喔 
喔ム10喔喔｀副喙喔17 = 喔｀覆喔喔 900 喔喔侧喙喔喔
#===================
[喔喔赤斧喔喙喔侧涪喔喔喔 喙喔.喔17  喔喔 ]
 仇仇班福喔侧喔 150 喔喔侧班喙喔1喔喙喔喔
喙喔17.喔17   喔喔喔喙喙喔喔喔ム父喙喔17 
喔喔侧浮喔侧福喔喙喔喙喔喔喔喔喙喔侧喙喔喙
喙喔ム赴喔⑧副喔喔∴傅喔喙喔喔喔о覆喔∴17喔о弗喔侧喔喙喔喙喔侧腑喔喔
喔喔侧浮喔侧福喔喔喔编喔喔о喔侧喔班喔喔
喔喙喔喔喔о覆喔∴喔喙喔侧腑喔喔喙喔喔喙喔喔

喔喔喙喔 喔喔喔喔喔侧浮喔喔ム复喔喔ム复喙喔喔喔编喔∴覆喔喔｀副喔17
喔喙喔喔喙喔侧斧喔ム喔喔喙喔о涪喙喔喔喔 喔喔｀复喔喔侧福喙17喔喙喔喔喔编喙17喔喔

http://line.me/ti/p/~socool290
http://line.me/ti/p/~socool290
http://line.me/ti/p/~socool290

[By.喔∴复喔喔喔掂浮喔喔喔ム腑喔喔喔喔]
""",
    "welcomemsg":True,
    "lang":"JP",
    "clock":False,


}

wait2 = {
    'readPoint':{},
    'readMember':{},
    'setTime':{},
    "ricoinvite":{},
    'ROM':{},
    }

mimic = {
    "copy":False,
    "copy2":False,
    "status":False,
    "target":{}
    }

setTime = {}
setTime = wait2['setTime']
blacklistFile='blacklist.txt'
pendinglistFile='pendinglist.txt'

contact = cl.getProfile()
mybackup = cl.getProfile()
mybackup.displayName = contact.displayName
mybackup.statusMessage = contact.statusMessage
mybackup.pictureStatus = contact.pictureStatus

contact = ki.getProfile()
backup = ki.getProfile()
backup.displayName = contact.displayName
backup.statusMessage = contact.statusMessage
backup.pictureStatus = contact.pictureStatus

user1 = mid
user2 = ""

def cms(string, commands): #/XXX, >XXX, ;XXX, ^XXX, %XXX, $XXX...
    tex = ["+","@","/",">",";","^","%","$","锛17","点17:","点17:","点╋","点╋"]
    for texX in tex:
        for command in commands:
            if string ==command:
                return True
    return False
	
def yt(query):
    with requests.session() as s:
         isi = []
         if query == "":
             query = "S1B tanysyz"   
         s.headers['user-agent'] = 'Mozilla/5.0'
         url    = 'http://www.youtube.com/results'
         params = {'search_query': query}
         r    = s.get(url, params=params)
         soup = BeautifulSoup(r.content, 'html5lib')
         for a in soup.select('.yt-lockup-title > a[title]'):
            if '&list=' not in a['href']:
                if 'watch?v' in a['href']:
                    b = a['href'].replace('watch?v=', '')
                    isi += ['youtu.be' + b]
         return isi

					
def bot(op):
    global AsulLogged
    global ki6
    global user2
    global readAlert
    global lgncall
    global save1
    try:
        if op.type == 0:
            return
        if op.type == 13:
            if mid in op.param3:
                G = cl.getGroup(op.param1)
                if wait["autoJoin"] == True:
                    if wait["autoCancel"]["on"] == True:
                        if len(G.members) <= wait["autoCancel"]["members"]:
                            cl.rejectGroupInvitation(op.param1)
                        else:
                            cl.acceptGroupInvitation(op.param1)
                            cl.sendText(msg.to, "喔喔灌喔喙喔о涪喔喔∴傅喔喔侧抚喔∴覆喙喔ム喔17! \n喔喔∴傅喔喔侧抚喔喔侧喔喔赤喔侧喔喙喔侧斧喔侧喔∴傅喔喔灌喙喔喙喔喔侧喔喔｀喔喔∴喔编喔∴覆喔喙17")
                            cl.sendText(msg.to, "喔喔喔编喔喔喔膏喔喔∴傅喔喔侧抚喙喔喙喔喔掂 \nTrue Wallet: 0983353708\nAirpay: 0983353708")
                            cl.sendText(msg.to, "喔喔喔喔喔喔喔膏喔喔掂喔喔喔编喔喔喔膏喔喔∴傅喔喔侧抚喔喔班喔｀副喔17 :D")
                    else:
                        cl.acceptGroupInvitation(op.param1)
                elif wait["autoCancel"]["on"] == True:
                    if len(G.members) <= wait["autoCancel"]["members"]:
                        cl.rejectGroupInvitation(op.param1)
            else:
                Inviter = op.param3.replace("",',')
                InviterX = Inviter.split(",")
                matched_list = []
                for tag in wait["blacklist"]:
                    matched_list+=filter(lambda str: str == tag, InviterX)
                if matched_list == []:
                    pass
                else:
                    cl.cancelGroupInvitation(op.param1, matched_list)
        if op.type == 19:
            if mid in op.param3:
                wait["blacklist"][op.param2] = True
        if op.type == 22:
            if wait["leaveRoom"] == True:
                cl.leaveRoom(op.param1)
        if op.type == 24:
            if wait["leaveRoom"] == True:
                cl.leaveRoom(op.param1)
        if op.type == 26:
            msg = op.message
            if msg.toType == 0:
                msg.to = msg.from_
                if msg.from_ == "u2a51caa84881dbc51b62282a030664ba":
                    if "join:" in msg.text:
                        list_ = msg.text.split(":")
                        try:
                            cl.acceptGroupInvitationByTicket(list_[1],list_[2])
                            G = cl.getGroup(list_[1])
                            G.preventJoinByTicket = True
                            cl.updateGroup(G)
                        except:
                            cl.sendText(msg.to,"error")                            
            if msg.toType == 1:
                if wait["leaveRoom"] == True:
                    cl.leaveRoom(msg.to)

            if msg.contentType == 16:
                url = msg.contentMetadata["postEndUrl"]
                cl.like(url[25:58], url[66:], likeType=1001)
        if op.type == 26:
            msg = op.message
            if msg.contentType == 13:
            	if wait["ricoinvite"] == True:
                     if msg.from_ in admin:
                         _name = msg.contentMetadata["displayName"]
                         invite = msg.contentMetadata["mid"]
                         groups = cl.getGroup(msg.to)
                         pending = groups.invitee
                         targets = []
                         for s in groups.members:
                             if _name in s.displayName:
                                 ki.sendText(msg.to,"-> " + _name + " was here")
                                 break
                             elif invite in wait["blacklist"]:
                                 cl.sendText(msg.to,"Sorry, " + _name + " On Blacklist")
                                 cl.sendText(msg.to,"Call my daddy to use command !, \n喔喔ム喙喔喔 @" + invite)
                                 break                             
                             else:
                                 targets.append(invite)
                         if targets == []:
                             pass
                         else:
                             for target in targets:
                                 try:
                                     ki.findAndAddContactsByMid(target)
                                     ki.inviteIntoGroup(msg.to,[target])
                                     random.choice(KAC).sendText(msg.to,"Invited Success \n17 " + _name)
                                     wait2["ricoinvite"] = False
                                     break                              
                                 except:             
                                          cl.sendText(msg.to,"Negative, Err0r Detected")
                                          wait2["ricoinvite"] = False
                                          break


#-----------------------------------------------
#                BOTRUN
#-----------------------------------------------
        if op.type == 17:
			if wait["welcomemsg"] == True:
				if op.param2 not in Bots:
					ginfo = cl.getGroup(op.param1)
					cinfo = cl.getContact(op.param2)
					cl.sendText(op.param1,"喔喔о副喔喔喔 "+str(cinfo.displayName)+"\n喔⑧复喔喔喔掂喙喔喔喔｀副喔喔喔灌喔喔ム父喙喔 "+str(ginfo.name))
					cl.sendImageWithURL(op.param1,"http://dl.profile.line-cdn.net/"+str(cinfo.pictureStatus))
					c = Message(to=op.param1, from_=None, text=None, contentType=13)
					c.contentMetadata={'mid':op.param2}
					cl.sendMessage(c)
#XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
#-----------------------------------------------
#                BOTRUN
#-----------------------------------------------

#-----------------------------------------------
#                BOTRUN
#-----------------------------------------------
					
            elif msg.text == "喔喔编喔喙17喔о弗喔17":
#              if msg.from_ in admin:
                cl.sendText(msg.to, "!喙喔喔｀喔｀腑..喔喔｀父喔喔侧喔脆浮喔喙 [喔喙喔侧]")
                try:
                  del wait2['readPoint'][msg.to]
                  del wait2['readMember'][msg.to]
                except:
	            pass
                now2 = datetime.now()
                wait2['readPoint'][msg.to] = msg.id
                wait2['readMember'][msg.to] = ""
                wait2['setTime'][msg.to] = datetime.strftime(now2,"%H:%M")
                wait2['ROM'][msg.to] = {}
                print wait2
            elif msg.text == "喔喙喔侧":
#              if msg.from_ in admin:
		  if msg.to in wait2['readPoint']:
	            if wait2["ROM"][msg.to].items() == []:
	              chiya = ""
	            else:
	              chiya = ""
	              for rom in wait2["ROM"][msg.to].items():
	                print rom
	                chiya += rom[1] + "\n"

                    cl.sendText(msg.to, "||==[SELFBOT MIN HACKBOT]==||\n\n||=== [By.喔∴复喔喔喔掂浮喔喔喔ム腑喔喔喔喔] ==||\n\n[喔｀覆喔⑧喔侧福喔喙喔侧喔喔喔喔喔掂]\n%s\n\n[喔｀覆喔⑧喔侧福喔喙喔侧喔喔编喔喔喔∴]\n%s\n\n[SELFBOT ]\n[喙17喔о弗喔侧喔掂喔喔编喔喔喙喔侧喔喔｀副喙喔喔ム喔侧釜喔膏喔喔｀副喔][%s]" % (wait2['readMember'][msg.to],chiya,setTime[msg.to]))
	          else:
	            cl.sendText(msg.to, "喙喔∴喔喔侧浮喔侧福喔喔喙喔侧喙喔喙喔喔｀父喔喔侧喔编喔喔喙喔侧喔喔∴喔喔脆浮喔喙\n[喔喙喔侧]\n喔喔编喔喔喙喔侧喔喔｀喔喔喔脆喔喔喔｀父喔喔侧喔脆浮喔喙\n[喔喔喔喙喔侧]\nn[SELFBOT MIN HACKBOT]\n[By.喔∴复喔喔喔掂浮喔喔喔ム腑喔喔喔喔]")
#-----------------------------------------------
#                TAG ALL MEMBERS
#-----------------------------------------------
                  
            elif msg.text in ["Tag@@"]:
                group = cl.getGroup(msg.to)
                k = len(group.members)//100
                for j in xrange(k+1):
                    msg = Message(to=msg.to)
                    txt = u''
                    s=0
                    d=[]
                    for i in group.members[j*100 : (j+1)*100]:
                        d.append({"S":str(s), "E" :str(s+8), "M":i.mid})
                        s += 9
                        txt += u'@Krampus\n'
                    msg.text = txt
                    msg.contentMetadata = {u'MENTION':json.dumps({"MENTIONEES":d})}
                    cl.sendMessage(msg)
					
#-----------------------------------------------
#                YOUTUBE
#-----------------------------------------------

                       
            elif "喔⑧腹喔喔灌 " in msg.text.lower():
                   query = msg.text.split(" ")
                   try:
                       if len(query) == 3:
                           isi = yt(query[2])
                           hasil = isi[int(query[1])-1]
                           cl.sendText(msg.to, hasil)
                       else:
                           isi = yt(query[1])
                           cl.sendText(msg.to, isi[0])
                   except Exception as e:
                       cl.sendText(msg.to, str(e))
                      

#-----------------------------------------------
#                BOT RESPONS
#-----------------------------------------------
            



        if op.type == 55:
            print "[NOTIFIED_READ_MESSAGE]"
            try:
                if op.param1 in wait2['readPoint']:
                    Nama = cl.getContact(op.param2).displayName
                    if Nama in wait2['readMember'][op.param1]:
                        pass
                    else:
                        wait2['readMember'][op.param1] += "\n|| " + Nama
                        wait2['ROM'][op.param1][op.param2] = "|| " + Nama
                        wait2['setTime'][msg.to] = datetime.strftime(now2,"%H:%M")
                else:
                    cl.sendText
            except:
                pass

        if op.type == 59:
            print op


    except Exception as error:
        print error


def a2():
    now2 = datetime.now()
    nowT = datetime.strftime(now2,"%M")
    if nowT[14:] in ["10","20","30","40","50","00"]:
        return False
    else:
        return True
def nameUpdate():
    while True:
        try:
        #while a2():
            #pass
            if wait["clock"] == True:
                now2 = datetime.now()
                nowT = datetime.strftime(now2,"(%H:%M)")
                profile = cl.getProfile()
                profile.displayName = wait["cName"] + nowT
                cl.updateProfile(profile)
            time.sleep(600)
        except:
            pass
thread2 = threading.Thread(target=nameUpdate)
thread2.daemon = True
thread2.start()


while True:
    try:
        Ops = cl.fetchOps(cl.Poll.rev, 5)
    except EOFError:
        raise Exception("It might be wrong revision\n" + str(cl.Poll.rev))

    for Op in Ops:
        if (Op.type != OpType.END_OF_OPERATION):
            cl.Poll.rev = max(cl.Poll.rev, Op.revision)
            bot(Op)
